generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String           @id @default(uuid())
  email     String           @unique
  password  String
  name      String
  role      UserRole         @default(operator)
  phone     String?
  avatar    String?
  isActive  Boolean          @default(true)
  lastLogin DateTime?
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  otp       String?
  otpExpiry DateTime?
  companyId String?
  employees Employee[]
  sales     Sale[]
  userRoles UserModuleRole[]
  auditLogs AuditLog[]
  company   Company?         @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@map("users")
}

model Company {
  id                String             @id @default(uuid())
  name              String
  tradeName         String?
  nuit              String?            @unique
  phone             String?
  email             String?
  address           String?
  businessType      BusinessType       @default(retail)
  status            CompanyStatus      @default(active)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  settings          Json?
  modules           CompanyModule[]
  products          Product[]
  users             User[]
  employees         Employee[]
  categories        Category[]
  suppliers         Supplier[]
  pharmacySales     PharmacySale[]
  prescriptions     Prescription[]
  rooms             Room[]
  bookings          Booking[]
  customers         Customer[]
  taxConfigs        TaxConfig[]
  sales             Sale[]
  invoices          Invoice[]
  alerts            Alert[]
  warehouses        Warehouse[]
  stockTransfers    StockTransfer[]
  customerOrders    CustomerOrder[]
  auditLogs         AuditLog[]
  housekeepingTasks HousekeepingTask[]
  transactions      Transaction[]
  campaigns         Campaign[]
  funnelStages      FunnelStage[]
  opportunities     Opportunity[]
  taxRetentions     TaxRetention[]
  fiscalReports     FiscalReport[]
  fiscalDeadlines   FiscalDeadline[]

  @@map("companies")
}

model Module {
  id          String          @id @default(uuid())
  code        String          @unique
  name        String
  description String?
  isActive    Boolean         @default(true)
  color       String?
  icon        String?
  companies   CompanyModule[]

  @@map("modules")
}

model Role {
  id          String           @id @default(uuid())
  code        String           @unique
  name        String
  description String?
  isSystem    Boolean          @default(false)
  createdAt   DateTime         @default(now())
  permissions RolePermission[]
  userRoles   UserModuleRole[]

  @@map("roles")
}

model Permission {
  id              String           @id @default(uuid())
  code            String           @unique
  name            String
  description     String?
  layer           String?
  module          String?
  rolePermissions RolePermission[]

  @@map("permissions")
}

model RolePermission {
  id           String     @id @default(uuid())
  roleId       String
  permissionId String
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  role         Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId])
  @@map("role_permissions")
}

model UserModuleRole {
  id        String   @id @default(uuid())
  userId    String
  moduleId  String?
  roleId    String
  createdAt DateTime @default(now())
  role      Role     @relation(fields: [roleId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@unique([userId, moduleId, roleId])
  @@index([userId])
  @@map("user_module_roles")
}

model CustomerHistory {
  id          String   @id @default(uuid())
  companyId   String
  customerId  String
  module      String
  action      String
  referenceId String?
  metadata    Json?
  createdAt   DateTime @default(now())
  customer    Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([customerId])
  @@index([module])
  @@map("customer_history")
}

model CompanyModule {
  id        String    @id @default(uuid())
  companyId String
  moduleId  String
  isActive  Boolean   @default(true)
  expiresAt DateTime?
  createdAt DateTime  @default(now())
  company   Company   @relation(fields: [companyId], references: [id])
  module    Module    @relation(fields: [moduleId], references: [id])

  @@unique([companyId, moduleId])
  @@map("company_modules")
}

model Product {
  id                  String               @id @default(uuid())
  code                String               @unique
  name                String
  description         String?
  category            ProductCategory      @default(other)
  price               Decimal              @db.Decimal(15, 2)
  costPrice           Decimal              @default(0) @db.Decimal(15, 2)
  currentStock        Int                  @default(0)
  minStock            Int                  @default(5)
  maxStock            Int?
  unit                String               @default("un")
  barcode             String?              @unique
  expiryDate          DateTime?
  batchNumber         String?
  location            String?
  status              StockStatus          @default(in_stock)
  imageUrl            String?
  isActive            Boolean              @default(true)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  supplierId          String?
  isReturnable        Boolean              @default(false)
  packSize            Int                  @default(1)
  returnPrice         Decimal              @default(0) @db.Decimal(15, 2)
  companyId           String?
  bookingConsumptions BookingConsumption[]
  creditNoteItems     CreditNoteItem[]
  invoiceItems        InvoiceItem[]
  medication          Medication?
  company             Company?             @relation(fields: [companyId], references: [id])
  supplier            Supplier?            @relation(fields: [supplierId], references: [id])
  purchaseOrderItems  PurchaseOrderItem[]
  saleItems           SaleItem[]
  stockMovements      StockMovement[]
  transferItems       StockTransferItem[]
  warehouseStocks     WarehouseStock[]

  @@map("products")
}

model Category {
  id          String     @id @default(uuid())
  code        String     @unique
  name        String
  description String?
  parentId    String?
  color       String?
  icon        String?
  isActive    Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  companyId   String?
  company     Company?   @relation(fields: [companyId], references: [id])
  parent      Category?  @relation("CategoryTree", fields: [parentId], references: [id])
  children    Category[] @relation("CategoryTree")

  @@map("categories")
}

model Warehouse {
  id             String           @id @default(uuid())
  code           String           @unique
  name           String
  location       String?
  responsible    String?
  isActive       Boolean          @default(true)
  isDefault      Boolean          @default(false)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  stockMovements StockMovement[]
  transfersFrom  StockTransfer[]  @relation("SourceWarehouse")
  transfersTo    StockTransfer[]  @relation("TargetWarehouse")
  stocks         WarehouseStock[]
  companyId      String?
  company        Company?         @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@map("warehouses")
}

model WarehouseStock {
  id          String    @id @default(uuid())
  warehouseId String
  productId   String
  quantity    Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  product     Product   @relation(fields: [productId], references: [id])
  warehouse   Warehouse @relation(fields: [warehouseId], references: [id])

  @@unique([warehouseId, productId])
  @@map("warehouse_stocks")
}

model StockTransfer {
  id                String              @id @default(uuid())
  number            String              @unique
  sourceWarehouseId String
  targetWarehouseId String
  status            TransferStatus      @default(pending)
  responsible       String
  reason            String?
  date              DateTime            @default(now())
  createdAt         DateTime            @default(now())
  items             StockTransferItem[]
  sourceWarehouse   Warehouse           @relation("SourceWarehouse", fields: [sourceWarehouseId], references: [id])
  targetWarehouse   Warehouse           @relation("TargetWarehouse", fields: [targetWarehouseId], references: [id])
  companyId         String?
  company           Company?            @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@map("stock_transfers")
}

model StockTransferItem {
  id         String        @id @default(uuid())
  transferId String
  productId  String
  quantity   Int
  product    Product       @relation(fields: [productId], references: [id])
  transfer   StockTransfer @relation(fields: [transferId], references: [id], onDelete: Cascade)

  @@map("stock_transfer_items")
}

model Customer {
  id                  String               @id @default(uuid())
  code                String               @unique
  name                String
  type                CustomerType         @default(individual)
  email               String?
  phone               String
  document            String?
  address             String?
  city                String?
  province            String?
  notes               String?
  creditLimit         Decimal?             @db.Decimal(15, 2)
  currentBalance      Decimal              @default(0) @db.Decimal(15, 2)
  totalPurchases      Decimal              @default(0) @db.Decimal(15, 2)
  isActive            Boolean              @default(true)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  loyaltyPoints       Int                  @default(0)
  loyaltyTier         String?              @default("Bronze")
  creditNotes         CreditNote[]
  history             CustomerHistory[]
  invoices            Invoice[]
  loyaltyTransactions LoyaltyTransaction[]
  opportunities       Opportunity[]
  pharmacySales       PharmacySale[]
  sales               Sale[]
  companyId           String?
  company             Company?             @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@map("customers")
}

model LoyaltyTransaction {
  id          String                 @id @default(uuid())
  customerId  String
  points      Int
  type        LoyaltyTransactionType
  description String?
  referenceId String?
  createdAt   DateTime               @default(now())
  customer    Customer               @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@map("loyalty_transactions")
}

model Supplier {
  id             String          @id @default(uuid())
  code           String          @unique
  name           String
  tradeName      String?
  nuit           String?
  email          String?
  phone          String
  phone2         String?
  address        String?
  city           String?
  province       String?
  contactPerson  String?
  paymentTerms   String?
  notes          String?
  currentBalance Decimal         @default(0) @db.Decimal(15, 2)
  totalPurchases Decimal         @default(0) @db.Decimal(15, 2)
  isActive       Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  companyId      String?
  company        Company?        @relation(fields: [companyId], references: [id])
  products       Product[]
  purchaseOrders PurchaseOrder[]

  @@map("suppliers")
}

model PurchaseOrder {
  id                   String              @id @default(uuid())
  orderNumber          String              @unique
  supplierId           String
  total                Decimal             @db.Decimal(15, 2)
  status               PurchaseOrderStatus @default(draft)
  expectedDeliveryDate DateTime?
  receivedDate         DateTime?
  notes                String?
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @updatedAt
  items                PurchaseOrderItem[]
  supplier             Supplier            @relation(fields: [supplierId], references: [id])

  @@map("purchase_orders")
}

model PurchaseOrderItem {
  id              String        @id @default(uuid())
  purchaseOrderId String
  productId       String
  quantity        Int
  receivedQty     Int           @default(0)
  unitCost        Decimal       @db.Decimal(15, 2)
  total           Decimal       @db.Decimal(15, 2)
  product         Product       @relation(fields: [productId], references: [id])
  purchaseOrder   PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)

  @@map("purchase_order_items")
}

model CustomerOrder {
  id              String                  @id @default(uuid())
  orderNumber     String                  @unique
  customerName    String
  customerPhone   String
  customerEmail   String?
  customerAddress String?
  total           Decimal                 @db.Decimal(15, 2)
  status          OrderStatus             @default(created)
  priority        OrderPriority           @default(normal)
  paymentMethod   String?
  deliveryDate    DateTime?
  notes           String?
  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @updatedAt
  items           CustomerOrderItem[]
  transitions     OrderStatusTransition[]
  companyId       String?
  company         Company?                @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@map("customer_orders")
}

model CustomerOrderItem {
  id          String        @id @default(uuid())
  orderId     String
  productId   String
  productName String
  quantity    Int
  price       Decimal       @db.Decimal(15, 2)
  total       Decimal       @db.Decimal(15, 2)
  order       CustomerOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("customer_order_items")
}

model OrderStatusTransition {
  id              String        @id @default(uuid())
  orderId         String
  status          OrderStatus
  responsibleName String?
  notes           String?
  timestamp       DateTime      @default(now())
  order           CustomerOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("order_status_transitions")
}

model Sale {
  id            String        @id @default(uuid())
  receiptNumber String        @unique
  customerId    String?
  userId        String
  subtotal      Decimal       @db.Decimal(15, 2)
  discount      Decimal       @default(0) @db.Decimal(15, 2)
  tax           Decimal       @default(0) @db.Decimal(15, 2)
  total         Decimal       @db.Decimal(15, 2)
  paymentMethod PaymentMethod @default(cash)
  amountPaid    Decimal       @db.Decimal(15, 2)
  change        Decimal       @default(0) @db.Decimal(15, 2)
  notes         String?
  createdAt     DateTime      @default(now())
  fiscalNumber  Int?
  hashCode      String?
  series        String?       @default("A")
  items         SaleItem[]
  customer      Customer?     @relation(fields: [customerId], references: [id])
  user          User          @relation(fields: [userId], references: [id])
  companyId     String?
  company       Company?      @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@map("sales")
}

model SaleItem {
  id        String  @id @default(uuid())
  saleId    String
  productId String
  quantity  Int
  unitPrice Decimal @db.Decimal(15, 2)
  discount  Decimal @default(0) @db.Decimal(15, 2)
  total     Decimal @db.Decimal(15, 2)
  product   Product @relation(fields: [productId], references: [id])
  sale      Sale    @relation(fields: [saleId], references: [id], onDelete: Cascade)

  @@map("sale_items")
}

model Invoice {
  id               String           @id @default(uuid())
  invoiceNumber    String           @unique
  orderId          String?
  orderNumber      String?
  customerId       String?
  customerName     String
  customerEmail    String?
  customerPhone    String?
  customerAddress  String?
  customerDocument String?
  subtotal         Decimal          @db.Decimal(15, 2)
  discount         Decimal          @default(0) @db.Decimal(15, 2)
  tax              Decimal          @default(0) @db.Decimal(15, 2)
  total            Decimal          @db.Decimal(15, 2)
  amountPaid       Decimal          @default(0) @db.Decimal(15, 2)
  amountDue        Decimal          @db.Decimal(15, 2)
  status           InvoiceStatus    @default(draft)
  issueDate        DateTime         @default(now())
  dueDate          DateTime
  paidDate         DateTime?
  notes            String?
  terms            String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  creditNotes      CreditNote[]
  items            InvoiceItem[]
  payments         InvoicePayment[]
  customer         Customer?        @relation(fields: [customerId], references: [id])
  companyId        String?
  company          Company?         @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@map("invoices")
}

model InvoiceItem {
  id          String   @id @default(uuid())
  invoiceId   String
  productId   String?
  description String
  quantity    Int
  unitPrice   Decimal  @db.Decimal(15, 2)
  discount    Decimal  @default(0) @db.Decimal(15, 2)
  total       Decimal  @db.Decimal(15, 2)
  invoice     Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  product     Product? @relation(fields: [productId], references: [id])

  @@map("invoice_items")
}

model InvoicePayment {
  id        String        @id @default(uuid())
  invoiceId String
  date      DateTime      @default(now())
  amount    Decimal       @db.Decimal(15, 2)
  method    PaymentMethod
  reference String?
  notes     String?
  invoice   Invoice       @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@map("invoice_payments")
}

model CreditNote {
  id                String           @id @default(uuid())
  number            String           @unique
  originalInvoiceId String
  customerId        String?
  customerName      String
  subtotal          Decimal          @db.Decimal(15, 2)
  tax               Decimal          @db.Decimal(15, 2)
  total             Decimal          @db.Decimal(15, 2)
  reason            String
  status            CreditNoteStatus @default(draft)
  issueDate         DateTime         @default(now())
  notes             String?
  createdAt         DateTime         @default(now())
  items             CreditNoteItem[]
  customer          Customer?        @relation(fields: [customerId], references: [id])
  originalInvoice   Invoice          @relation(fields: [originalInvoiceId], references: [id])

  @@map("credit_notes")
}

model CreditNoteItem {
  id                    String     @id @default(uuid())
  creditNoteId          String
  productId             String?
  description           String
  quantity              Int
  unitPrice             Decimal    @db.Decimal(15, 2)
  total                 Decimal    @db.Decimal(15, 2)
  originalInvoiceItemId String?
  creditNote            CreditNote @relation(fields: [creditNoteId], references: [id], onDelete: Cascade)
  product               Product?   @relation(fields: [productId], references: [id])

  @@map("credit_note_items")
}

model Employee {
  id                   String                  @id @default(uuid())
  code                 String                  @unique
  name                 String
  email                String                  @unique
  phone                String
  role                 EmployeeRole            @default(operator)
  department           String?
  hireDate             DateTime
  address              String?
  documentNumber       String?
  emergencyContact     String?
  profileImage         String?
  isActive             Boolean                 @default(true)
  birthDate            DateTime?
  maritalStatus        MaritalStatus?
  dependents           Int                     @default(0)
  bankName             String?
  bankAccountNumber    String?
  bankNib              String?
  socialSecurityNumber String?
  nuit                 String?
  baseSalary           Decimal                 @db.Decimal(15, 2)
  subsidyTransport     Decimal                 @default(0) @db.Decimal(15, 2)
  subsidyFood          Decimal                 @default(0) @db.Decimal(15, 2)
  vacationDaysTotal    Int                     @default(22)
  vacationDaysUsed     Int                     @default(0)
  createdAt            DateTime                @default(now())
  updatedAt            DateTime                @updatedAt
  userId               String?
  contractExpiry       DateTime?
  contractType         ContractType            @default(indefinite)
  companyId            String?
  inAttendanceRoster   Boolean                 @default(false)
  qualifications       AcademicQualification[]
  attendanceRecords    AttendanceRecord[]
  user                 User?                   @relation(fields: [userId], references: [id])
  company              Company?                @relation(fields: [companyId], references: [id])
  payrollRecords       PayrollRecord[]
  vacationRequests     VacationRequest[]

  @@index([companyId])
  @@map("employees")
}

model AcademicQualification {
  id                String         @id @default(uuid())
  employeeId        String
  level             EducationLevel
  courseName        String
  institution       String
  startYear         Int
  endYear           Int?
  isCompleted       Boolean        @default(false)
  certificateNumber String?
  employee          Employee       @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("academic_qualifications")
}

model AttendanceRecord {
  id            String           @id @default(uuid())
  employeeId    String
  date          DateTime
  checkIn       DateTime?
  checkOut      DateTime?
  status        AttendanceStatus @default(present)
  hoursWorked   Decimal?         @db.Decimal(5, 2)
  notes         String?
  justification String?
  employee      Employee         @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([employeeId, date])
  @@map("attendance_records")
}

model PayrollRecord {
  id              String        @id @default(uuid())
  employeeId      String
  month           Int
  year            Int
  baseSalary      Decimal       @db.Decimal(15, 2)
  otHours         Decimal       @default(0) @db.Decimal(5, 2)
  otAmount        Decimal       @default(0) @db.Decimal(15, 2)
  bonus           Decimal       @default(0) @db.Decimal(15, 2)
  allowances      Decimal       @default(0) @db.Decimal(15, 2)
  inssDeduction   Decimal       @default(0) @db.Decimal(15, 2)
  irtDeduction    Decimal       @default(0) @db.Decimal(15, 2)
  advances        Decimal       @default(0) @db.Decimal(15, 2)
  totalEarnings   Decimal       @db.Decimal(15, 2)
  totalDeductions Decimal       @db.Decimal(15, 2)
  netSalary       Decimal       @db.Decimal(15, 2)
  status          PayrollStatus @default(draft)
  processedAt     DateTime?
  paidAt          DateTime?
  notes           String?
  employee        Employee      @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([employeeId, month, year])
  @@map("payroll_records")
}

model VacationRequest {
  id         String         @id @default(uuid())
  employeeId String
  startDate  DateTime
  endDate    DateTime
  days       Int
  status     VacationStatus @default(pending)
  approvedBy String?
  notes      String?
  createdAt  DateTime       @default(now())
  employee   Employee       @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("vacation_requests")
}

model Transaction {
  id            String            @id @default(uuid())
  type          TransactionType
  category      String
  description   String
  amount        Decimal           @db.Decimal(15, 2)
  date          DateTime          @default(now())
  dueDate       DateTime?
  status        TransactionStatus @default(pending)
  paymentMethod PaymentMethod?
  reference     String?
  notes         String?

  // Multi-tenancy
  companyId String?
  company   Company? @relation(fields: [companyId], references: [id])

  // Hospitality-specific fields
  bookingId String?
  booking   Booking? @relation(fields: [bookingId], references: [id])
  roomId    String?
  room      Room?    @relation(fields: [roomId], references: [id])
  module    String? // hospitality, pharmacy, retail, etc.

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([companyId])
  @@index([bookingId])
  @@index([module])
  @@index([type])
  @@index([date])
  @@map("transactions")
}

model Alert {
  id          String        @id @default(uuid())
  type        AlertType
  priority    AlertPriority @default(medium)
  title       String
  message     String
  isRead      Boolean       @default(false)
  isResolved  Boolean       @default(false)
  relatedId   String?
  relatedType String?
  createdAt   DateTime      @default(now())
  resolvedAt  DateTime?
  companyId   String?
  company     Company?      @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@map("alerts")
}

model CompanySettings {
  id           String       @id @default(uuid())
  companyName  String
  tradeName    String?
  nuit         String?
  phone        String?
  email        String?
  address      String?
  city         String?
  province     String?
  country      String       @default("Mo√ßambique")
  logo         String?
  ivaRate      Decimal      @default(16) @db.Decimal(5, 2)
  currency     String       @default("MZN")
  businessType BusinessType @default(retail)

  @@map("company_settings")
}

model Campaign {
  id                 String          @id @default(uuid())
  name               String
  description        String?
  code               String?         @unique
  status             CampaignStatus  @default(draft)
  startDate          DateTime
  endDate            DateTime
  discountType       DiscountType
  discountValue      Decimal         @db.Decimal(15, 2)
  minPurchaseAmount  Decimal?        @db.Decimal(15, 2)
  maxDiscountAmount  Decimal?        @db.Decimal(15, 2)
  maxTotalUses       Int?
  currentUses        Int             @default(0)
  applyToAllProducts Boolean         @default(true)
  createdBy          String?
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt
  usages             CampaignUsage[]
  companyId          String?
  company            Company?        @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@map("campaigns")
}

model CampaignUsage {
  id           String   @id @default(uuid())
  campaignId   String
  customerId   String?
  customerName String?
  orderId      String?
  discount     Decimal  @db.Decimal(15, 2)
  usedAt       DateTime @default(now())
  campaign     Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@map("campaign_usages")
}

model AuditLog {
  id        String   @id @default(uuid())
  userId    String?
  userName  String?
  action    String
  entity    String
  entityId  String?
  oldData   Json?
  newData   Json?
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  companyId String?
  company   Company? @relation(fields: [companyId], references: [id])
  user      User?    @relation(fields: [userId], references: [id])

  @@index([companyId])
  @@index([userId])
  @@index([action])
  @@index([entity])
  @@index([createdAt])
  @@map("audit_logs")
}

model AlertConfig {
  id                      String   @id @default(uuid())
  lowStockThreshold       Int      @default(10)
  expiryWarningDays       Int      @default(30)
  paymentDueDays          Int      @default(7)
  enableEmailAlerts       Boolean  @default(true)
  enablePushNotifications Boolean  @default(true)
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  @@map("alert_config")
}

model FunnelStage {
  id                String        @id @default(uuid())
  code              String        @unique
  name              String
  type              String
  order             Int
  color             String
  icon              String?
  description       String?
  isClosedStage     Boolean       @default(false)
  isWonStage        Boolean       @default(false)
  autoMoveOnInvoice Boolean       @default(false)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  opportunities     Opportunity[]
  companyId         String?
  company           Company?      @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@map("funnel_stages")
}

model Opportunity {
  id                String         @id @default(uuid())
  title             String
  description       String?
  value             Decimal        @db.Decimal(15, 2)
  probability       Int
  customerId        String?
  stageId           String
  stageType         String
  expectedCloseDate DateTime?
  closedAt          DateTime?
  closedReason      String?
  invoiceId         String?
  userId            String?
  notes             String?
  tags              String[]
  stageChangedAt    DateTime       @default(now())
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  interactions      Interaction[]
  customer          Customer?      @relation(fields: [customerId], references: [id])
  stage             FunnelStage    @relation(fields: [stageId], references: [id])
  stageHistory      StageHistory[]
  companyId         String?
  company           Company?       @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@map("opportunities")
}

model Interaction {
  id            String      @id @default(uuid())
  opportunityId String
  type          String
  subject       String?
  notes         String?
  userId        String?
  userName      String?
  outcome       String?
  nextSteps     String?
  createdAt     DateTime    @default(now())
  opportunity   Opportunity @relation(fields: [opportunityId], references: [id], onDelete: Cascade)

  @@map("interactions")
}

model StageHistory {
  id                  String      @id @default(uuid())
  opportunityId       String
  fromStageId         String
  fromStageName       String
  toStageId           String
  toStageName         String
  changedAt           DateTime    @default(now())
  changedBy           String?
  reason              String?
  timeInPreviousStage Int?
  opportunity         Opportunity @relation(fields: [opportunityId], references: [id], onDelete: Cascade)

  @@map("stage_history")
}

model TaxConfig {
  id            String    @id @default(uuid())
  type          String
  name          String
  description   String?
  rate          Decimal   @db.Decimal(5, 2)
  isActive      Boolean   @default(true)
  applicableTo  String[]
  effectiveFrom DateTime
  effectiveTo   DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  companyId     String?
  company       Company?  @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@map("tax_configs")
}

model IRPSBracket {
  id             String   @id @default(uuid())
  minIncome      Decimal  @db.Decimal(15, 2)
  maxIncome      Decimal? @db.Decimal(15, 2)
  rate           Decimal  @db.Decimal(5, 2)
  fixedDeduction Decimal  @db.Decimal(15, 2)
  isActive       Boolean  @default(true)
  year           Int
  createdAt      DateTime @default(now())

  @@map("irps_brackets")
}

model TaxRetention {
  id             String    @id @default(uuid())
  type           String
  entityType     String
  entityId       String
  period         String
  baseAmount     Decimal   @db.Decimal(15, 2)
  retainedAmount Decimal   @db.Decimal(15, 2)
  rate           Decimal   @db.Decimal(5, 2)
  description    String?
  isPaid         Boolean   @default(false)
  paidAt         DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  companyId      String?
  company        Company?  @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@map("tax_retentions")
}

model FiscalReport {
  id           String    @id @default(uuid())
  type         String
  period       String
  status       String
  reportData   Json
  submittedAt  DateTime?
  submittedBy  String?
  responseData Json?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  companyId    String?
  company      Company?  @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@map("fiscal_reports")
}

model FiscalDeadline {
  id          String    @id @default(uuid())
  type        String
  name        String
  description String?
  dueDate     DateTime
  period      String
  status      String    @default("pending")
  completedAt DateTime?
  completedBy String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  companyId   String?
  company     Company?  @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@map("fiscal_deadlines")
}

model DocumentSeries {
  id         String   @id @default(uuid())
  code       String   @unique
  name       String
  prefix     String
  series     String
  lastNumber Int      @default(0)
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("document_series")
}

model Room {
  id                String             @id @default(uuid())
  number            String             @unique
  type              RoomType           @default(single)
  status            RoomStatus         @default(available)
  price             Decimal            @db.Decimal(15, 2)
  notes             String?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  priceBreakfast    Decimal?           @db.Decimal(15, 2)
  priceFullBoard    Decimal?           @db.Decimal(15, 2)
  priceHalfBoard    Decimal?           @db.Decimal(15, 2)
  priceNoMeal       Decimal?           @db.Decimal(15, 2)
  companyId         String?
  company           Company?           @relation(fields: [companyId], references: [id])
  bookings          Booking[]
  housekeepingTasks HousekeepingTask[]
  transactions      Transaction[]

  @@index([companyId])
  @@map("rooms")
}

model Booking {
  id                  String               @id @default(uuid())
  roomId              String
  customerId          String?
  customerName        String
  guestCount          Int                  @default(1)
  checkIn             DateTime
  checkOut            DateTime?
  totalPrice          Decimal              @db.Decimal(15, 2)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  status              BookingStatus        @default(pending)
  guestDocumentNumber String?
  guestDocumentType   String?
  guestNationality    String?
  guestPhone          String?
  notes               String?
  mealPlan            MealPlan             @default(none)
  expectedCheckout    DateTime?
  companyId           String?
  company             Company?             @relation(fields: [companyId], references: [id])
  consumptions        BookingConsumption[]
  room                Room                 @relation(fields: [roomId], references: [id])
  transactions        Transaction[]

  @@index([companyId])
  @@map("bookings")
}

model BookingConsumption {
  id        String   @id @default(uuid())
  bookingId String
  productId String
  quantity  Int      @default(1)
  unitPrice Decimal  @db.Decimal(15, 2)
  total     Decimal  @db.Decimal(15, 2)
  createdAt DateTime @default(now())
  companyId String?
  booking   Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id])

  @@index([companyId])
  @@map("booking_consumptions")
}

model HousekeepingTask {
  id          String             @id @default(uuid())
  roomId      String
  type        HousekeepingType   @default(checkout_cleaning)
  status      HousekeepingStatus @default(pending)
  priority    Int                @default(1)
  assignedTo  String?
  notes       String?
  scheduledAt DateTime?
  startedAt   DateTime?
  completedAt DateTime?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  companyId   String?
  company     Company?           @relation(fields: [companyId], references: [id])
  room        Room               @relation(fields: [roomId], references: [id])

  @@index([companyId])
  @@map("housekeeping_tasks")
}

model Medication {
  id                   String            @id @default(uuid())
  productId            String            @unique
  dci                  String?
  dosage               String?
  pharmaceuticalForm   String?
  atcCode              String?
  laboratory           String?
  requiresPrescription Boolean           @default(false)
  isControlled         Boolean           @default(false)
  controlLevel         String?
  storageTemp          String            @default("ambiente")
  contraindications    String?
  sideEffects          String?
  activeIngredient     String?
  concentration        String?
  createdAt            DateTime          @default(now())
  updatedAt            DateTime          @updatedAt
  batches              MedicationBatch[]
  product              Product           @relation(fields: [productId], references: [id])

  @@map("medications")
}

model MedicationBatch {
  id                String             @id @default(uuid())
  medicationId      String
  batchNumber       String
  quantity          Int
  quantityAvailable Int
  expiryDate        DateTime
  receivedDate      DateTime           @default(now())
  costPrice         Decimal            @db.Decimal(15, 2)
  sellingPrice      Decimal            @db.Decimal(15, 2)
  supplier          String?
  invoiceNumber     String?
  status            BatchStatus        @default(active)
  notes             String?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  medication        Medication         @relation(fields: [medicationId], references: [id])
  saleItems         PharmacySaleItem[]

  @@map("medication_batches")
}

model PharmacySale {
  id             String             @id @default(uuid())
  saleNumber     String             @unique
  customerId     String?
  customerName   String?
  prescriptionId String?
  subtotal       Decimal            @db.Decimal(15, 2)
  discount       Decimal            @default(0) @db.Decimal(15, 2)
  total          Decimal            @db.Decimal(15, 2)
  paymentMethod  String             @default("cash")
  paymentDetails Json?
  status         PharmacySaleStatus @default(completed)
  soldBy         String
  notes          String?
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  companyId      String?
  company        Company?           @relation(fields: [companyId], references: [id])
  items          PharmacySaleItem[]
  customer       Customer?          @relation(fields: [customerId], references: [id])
  prescription   Prescription?      @relation(fields: [prescriptionId], references: [id])

  @@map("pharmacy_sales")
}

model PharmacySaleItem {
  id            String          @id @default(uuid())
  saleId        String
  batchId       String
  productName   String
  quantity      Int
  unitPrice     Decimal         @db.Decimal(15, 2)
  discount      Decimal         @default(0) @db.Decimal(15, 2)
  total         Decimal         @db.Decimal(15, 2)
  posologyLabel String?
  batch         MedicationBatch @relation(fields: [batchId], references: [id])
  sale          PharmacySale    @relation(fields: [saleId], references: [id])

  @@map("pharmacy_sale_items")
}

model Prescription {
  id               String             @id @default(uuid())
  prescriptionNo   String             @unique
  patientName      String
  patientPhone     String?
  patientBirthDate DateTime?
  patientAddress   String?
  prescriberName   String
  prescriberCRM    String?
  prescriberPhone  String?
  facility         String?
  prescriptionDate DateTime
  validUntil       DateTime?
  diagnosis        String?
  status           PrescriptionStatus @default(pending)
  isControlled     Boolean            @default(false)
  notes            String?
  imageUrl         String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  companyId        String?
  company          Company?           @relation(fields: [companyId], references: [id])
  sales            PharmacySale[]
  items            PrescriptionItem[]

  @@map("prescriptions")
}

model PrescriptionItem {
  id                String       @id @default(uuid())
  prescriptionId    String
  medicationName    String
  medicationId      String?
  dosage            String?
  quantity          Int
  quantityDispensed Int          @default(0)
  posology          String?
  duration          String?
  notes             String?
  prescription      Prescription @relation(fields: [prescriptionId], references: [id])

  @@map("prescription_items")
}

model StockMovement {
  id            String       @id @default(uuid())
  batchId       String?
  movementType  MovementType
  quantity      Int
  balanceBefore Int
  balanceAfter  Int
  reference     String?
  reason        String?
  performedBy   String
  createdAt     DateTime     @default(now())
  companyId     String?
  originModule  String?
  productId     String?
  referenceType String?
  warehouseId   String?
  product       Product?     @relation(fields: [productId], references: [id])
  warehouse     Warehouse?   @relation(fields: [warehouseId], references: [id])

  @@index([companyId])
  @@index([originModule])
  @@index([productId])
  @@index([warehouseId])
  @@map("stock_movements")
}

model PharmacyDashboardCache {
  id        String   @id @default(uuid())
  metric    String   @unique
  value     Json
  updatedAt DateTime @updatedAt

  @@map("pharmacy_dashboard_cache")
}

enum CompanyStatus {
  active
  trial
  blocked
  cancelled
}

enum UserRole {
  super_admin
  admin
  manager
  operator
  cashier
  stock_keeper
}

enum ProductCategory {
  electronics
  food
  medicine
  clothing
  furniture
  cosmetics
  beverages
  cleaning
  office
  other
}

enum StockStatus {
  in_stock
  low_stock
  out_of_stock
}

enum TransferStatus {
  pending
  completed
  cancelled
}

enum CustomerType {
  individual
  company
}

enum LoyaltyTransactionType {
  earn
  redeem
  adjustment
  expiry
}

enum PurchaseOrderStatus {
  draft
  ordered
  partial
  received
  cancelled
}

enum OrderStatus {
  created
  printed
  separated
  completed
  cancelled
}

enum OrderPriority {
  low
  normal
  high
  urgent
}

enum PaymentMethod {
  cash
  card
  pix
  transfer
  credit
  mpesa
  emola
}

enum InvoiceStatus {
  draft
  sent
  paid
  partial
  overdue
  cancelled
}

enum CreditNoteStatus {
  draft
  issued
  refunded
}

enum EmployeeRole {
  admin
  manager
  operator
  cashier
  stock_keeper
}

enum AttendanceStatus {
  present
  absent
  late
  half_day
  leave
  holiday
  vacation
}

enum MaritalStatus {
  single
  married
  divorced
  widowed
}

enum EducationLevel {
  ensino_fundamental
  ensino_medio
  tecnico
  graduacao
  pos_graduacao
  mestrado
  doutorado
}

enum ContractType {
  indefinite
  fixed_term
}

enum PayrollStatus {
  draft
  processed
  paid
}

enum VacationStatus {
  pending
  approved
  rejected
  completed
}

enum TransactionType {
  income
  expense
}

enum TransactionStatus {
  pending
  completed
  cancelled
}

enum AlertType {
  low_stock
  expired_product
  payment_due
  order_delayed
  system
  employee
  sales
}

enum AlertPriority {
  critical
  high
  medium
  low
}

enum BusinessType {
  retail
  pharmacy
  supermarket
  hotel
  logistics
  bottlestore
}

enum CampaignStatus {
  draft
  active
  paused
  completed
  cancelled
}

enum DiscountType {
  percentage
  fixed
  free_shipping
  buy_x_get_y
}

enum RoomStatus {
  available
  occupied
  dirty
  maintenance
}

enum RoomType {
  single
  double
  suite
  deluxe
}

enum BookingStatus {
  pending
  confirmed
  checked_in
  checked_out
  cancelled
  no_show
}

enum MealPlan {
  none
  breakfast
  half_board
  full_board
}

enum HousekeepingType {
  checkout_cleaning
  stay_cleaning
  deep_cleaning
  maintenance_prep
}

enum HousekeepingStatus {
  pending
  in_progress
  completed
  cancelled
}

enum BatchStatus {
  active
  low_stock
  expired
  quarantine
  depleted
}

enum PharmacySaleStatus {
  pending
  completed
  cancelled
  refunded
}

enum PrescriptionStatus {
  pending
  partial
  dispensed
  expired
  cancelled
}

enum MovementType {
  purchase
  sale
  return_in
  return_out
  adjustment
  expired
  transfer
  loss
}
